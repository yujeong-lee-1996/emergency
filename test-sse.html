<!DOCTYPE html>
<html>
<head>
    <title>SSE í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>SSE ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    <div id="log"></div>

    <script>
        const log = document.getElementById('log');

        function addLog(msg) {
            const p = document.createElement('p');
            p.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            log.appendChild(p);
            console.log(msg);
        }

        addLog('SSE ì—°ê²° ì‹œë„...');

        // job_idë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥ (ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸í•œ ê²ƒìœ¼ë¡œ)
        const jobId = '141c1ddbdb8b'; // ì‹¤ì œ job_idë¡œ ë°”ê¿”ì£¼ì„¸ìš”

        const sse = new EventSource(`http://localhost:8000/events?job_id=${jobId}`);

        sse.onopen = function(event) {
            addLog('âœ… SSE ì—°ê²° ì„±ê³µ!');
        };

        sse.onmessage = function(event) {
            addLog('ğŸ“¨ ë©”ì‹œì§€ ë°›ìŒ: ' + event.data);

            try {
                const data = JSON.parse(event.data);
                if (data.type === 'tick' && data.boxes) {
                    addLog(`ğŸ¯ ë°•ìŠ¤ ${data.boxes.length}ê°œ ê°ì§€ë¨!`);
                }
            } catch (e) {
                addLog('íŒŒì‹± ì—ëŸ¬: ' + e.message);
            }
        };

        sse.onerror = function(event) {
            addLog('âŒ SSE ì—ëŸ¬ ë°œìƒ');
            console.error('SSE Error:', event);
        };
    </script>
</body>
</html>